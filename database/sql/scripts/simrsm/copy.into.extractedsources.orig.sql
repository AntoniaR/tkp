DECLARE odsid,oimgid INT;
SET odsid = insertDataset('Sim. const. flux/pos. of 1000 maps');
SET oimgid = insertImage(odsid,324384765.625,3906250.0,'2002-09-30-01:00:00.0','/home/scheers/simsa/posflux/mJy_4maps1000/SOURCESINSERTED1.FITS');
CALL InsertSrc(oimgid,266.803686767,-29.8962710841,0.00159770663316,0.00115537301491,0.0780348356114,0.0101818686608,0.070730823109,0.0166316165942,7.33609708669);
CALL InsertSrc(oimgid,266.800430284,-29.6819660086,0.00118320238948,0.00100782790623,0.116809967803,0.0111665275257,0.127295697215,0.0205675411068,10.8617107297);
CALL InsertSrc(oimgid,266.800298785,-29.7880453238,0.00162642205578,0.00168636237817,0.0851485975856,0.0110241731978,0.11514556694,0.0235824754185,8.13046410344);
CALL InsertSrc(oimgid,266.799212568,-29.5755830132,0.00122781168574,0.00104026721443,0.102312274915,0.0110026571822,0.0932134987072,0.0179945814611,9.17541300689);
CALL InsertSrc(oimgid,266.67743772,-29.68160451,0.000733366746147,0.000578348826501,0.211607118918,0.0120494767896,0.225874064043,0.0218267334402,17.4988313432);
CALL InsertSrc(oimgid,266.677030624,-29.575706647,0.000530498872308,0.000463618028196,0.250801305121,0.0109333912275,0.266883298422,0.0197556477564,23.2500794716);
CALL InsertSrc(oimgid,266.680510101,-30.3215371889,0.00106275550951,0.000849796047294,0.123407480053,0.0108961180016,0.117684806387,0.0183378631758,11.0345501819);
CALL InsertSrc(oimgid,266.680509825,-30.2144759321,0.0009920196905,0.000962090382796,0.138083524277,0.011281042751,0.163137311848,0.0219151563603,12.9586764133);
CALL InsertSrc(oimgid,266.677766634,-30.1079518641,0.000968044223612,0.000806822591993,0.155274587615,0.0114342819493,0.175832056425,0.0215889723495,13.6819070801);
CALL InsertSrc(oimgid,266.678631863,-30.0021283453,0.000901284979705,0.000758680275879,0.163031912351,0.0120609360903,0.158491846145,0.020570367895,13.1349504489);
CALL InsertSrc(oimgid,266.678304888,-29.8955317177,0.000622811910432,0.000514433164565,0.187680302487,0.0101267058696,0.167844636623,0.0163103907567,17.9776648608);
CALL InsertSrc(oimgid,266.67836938,-29.7891462185,0.000711003180072,0.000642386496427,0.220094521506,0.0130008846871,0.23679591527,0.023677609798,17.180744373);
CALL InsertSrc(oimgid,266.556263752,-30.322550283,0.000488457057656,0.000468236292136,0.267352106178,0.011082843297,0.284174580672,0.0200151578182,24.7113299542);
CALL InsertSrc(oimgid,266.555758927,-30.2155599982,0.000499271130991,0.000415905804029,0.269917119076,0.0109642965044,0.269039634796,0.0189697186313,24.5372905156);
CALL InsertSrc(oimgid,266.555690531,-30.0022648268,0.000462964289113,0.000414574706522,0.299598321005,0.0116137618161,0.311431123871,0.0206536143025,25.8954169873);
CALL InsertSrc(oimgid,266.555369946,-29.8953574648,0.000419585524355,0.000337357639392,0.325440683677,0.0107956414948,0.343264714961,0.0193857111628,30.2931893751);
CALL InsertSrc(oimgid,266.554765306,-29.7890688176,0.000464940704887,0.000376350463881,0.322135752191,0.0120496317873,0.327376535937,0.0211070866931,26.7583969601);
CALL InsertSrc(oimgid,266.55456501,-29.6823134806,0.000368427911553,0.000317058684647,0.336461720082,0.0103847512836,0.334762078976,0.0179326211182,32.3247988872);
CALL InsertSrc(oimgid,266.554154657,-29.5754714206,0.000351683554129,0.000304821478526,0.370905005999,0.0105570318956,0.404162679775,0.0193781037393,35.652491397);
CALL InsertSrc(oimgid,266.555521942,-30.108906251,0.000432690397417,0.000425003333117,0.272632262116,0.010294265676,0.277909701215,0.0180841182169,26.3649381372);
CALL InsertSrc(oimgid,266.432761835,-30.3227136155,0.000427338267571,0.00036518986866,0.371552416649,0.0128621483183,0.398185309339,0.0233627984423,29.6838476133);
CALL InsertSrc(oimgid,266.432063044,-30.2153433934,0.000320383364624,0.000273284543802,0.403344775831,0.0108334827162,0.402900395297,0.0187673377976,37.0202556057);
CALL InsertSrc(oimgid,266.432667922,-30.1092718306,0.000324048425796,0.000269382649325,0.390706836192,0.0104039866319,0.389694607128,0.0179935640517,37.485176272);
CALL InsertSrc(oimgid,266.432536074,-30.0024850424,0.000274148831522,0.000241957389441,0.42250624227,0.0100213392322,0.40681382349,0.0169301726644,41.258098787);
CALL InsertSrc(oimgid,266.432023031,-29.8958939291,0.000280742052439,0.000235040709139,0.453442745558,0.0106506278543,0.441158927263,0.018116927661,41.7750285142);
CALL InsertSrc(oimgid,266.431962217,-29.7887063433,0.000289629601696,0.00024287645385,0.457045868085,0.0106139290578,0.484892080927,0.0191302923227,43.2039058667);
CALL InsertSrc(oimgid,266.43166324,-29.6823668818,0.000257097295616,0.000222805466041,0.492634719323,0.0105910302557,0.497591476008,0.0184699754985,46.9010437629);
CALL InsertSrc(oimgid,266.431694107,-29.5753506237,0.000284291485343,0.000241686251638,0.498795230319,0.0121055141465,0.475658163151,0.0203205893027,39.9208004525);
CALL InsertSrc(oimgid,266.308652781,-30.2152951273,0.000224065868849,0.000190302087809,0.52292441403,0.00977926151407,0.510984807448,0.0166841734979,52.8767432941);
CALL InsertSrc(oimgid,266.308990599,-30.0020301332,0.000238776398817,0.00019931623638,0.538750583455,0.010499110389,0.552224144163,0.0184908956846,51.7531213875);
CALL InsertSrc(oimgid,266.30953333,-29.8957205358,0.000292011122554,0.000242304554884,0.561826659295,0.0129762994431,0.608529178337,0.0237171782171,44.0755258424);
CALL InsertSrc(oimgid,266.309472955,-29.5756263365,0.000197565690485,0.00016833168484,0.617459013133,0.0104012459819,0.592821061767,0.0175367140072,58.1943011238);
CALL InsertSrc(oimgid,266.308670356,-30.3220633028,0.000299309056743,0.000242708205509,0.51324529485,0.0120586636589,0.530643053954,0.0213765472067,42.638015029);
CALL InsertSrc(oimgid,266.308978037,-30.1088438789,0.000240774667304,0.000203886001991,0.523408681516,0.0106330132141,0.505377402937,0.0179952569794,48.4552497306);
CALL InsertSrc(oimgid,266.308998266,-29.7889145202,0.00024024664333,0.000202017458719,0.574046929829,0.0116582433148,0.544611651165,0.0195044469514,47.7962075589);
CALL InsertSrc(oimgid,266.309181206,-29.6819664814,0.000206123771022,0.000177671987618,0.601970818674,0.0103983163395,0.602027086627,0.0180133300955,57.1929381733);
CALL InsertSrc(oimgid,266.185408237,-30.3222184369,0.000212269793792,0.000182120695332,0.641083376595,0.0113665886717,0.645172509958,0.0197777044094,56.4335435621);
CALL InsertSrc(oimgid,266.185335976,-30.2155469706,0.000200992651457,0.000163980727109,0.651453880548,0.0106676319772,0.645765036343,0.0183718734853,61.0320959052);
CALL InsertSrc(oimgid,266.185925458,-30.1087740651,0.000220613149736,0.000181987339239,0.643549163962,0.0115507843558,0.652274505906,0.0201893418909,55.7205897092);
CALL InsertSrc(oimgid,266.185606166,-30.0021823424,0.000192027935839,0.000158092989871,0.681245400521,0.010620540533,0.68805411714,0.0185200356169,64.2668728827);
CALL InsertSrc(oimgid,266.185969594,-29.8955342946,0.000198756351836,0.000170366831934,0.702677130212,0.0113631395411,0.742029728662,0.0204149516193,62.8598171352);
CALL InsertSrc(oimgid,266.186088377,-29.7887230701,0.000177068311871,0.000145017117266,0.694542723534,0.00989373717223,0.716680113707,0.0175007931641,70.047945536);
CALL InsertSrc(oimgid,266.18631173,-29.68221933,0.000161055594447,0.00013857127071,0.709006546418,0.00941377087587,0.728742267784,0.0166082632634,75.727808397);
CALL InsertSrc(oimgid,266.186376832,-29.5754958675,0.000170533884102,0.000146097079131,0.74413034683,0.0105503543657,0.756071954495,0.0184708286155,70.5894821903);
CALL InsertSrc(oimgid,266.061674821,-30.3220107929,0.000196265135685,0.000167225954605,0.757258506663,0.0122636101865,0.767024270494,0.0214254864168,61.5277954699);
CALL InsertSrc(oimgid,266.061878075,-30.2152490216,0.000174977269296,0.00014780236879,0.759365386621,0.0111770050637,0.740627954083,0.0190433751841,66.6636070749);
CALL InsertSrc(oimgid,266.062274014,-30.1084090756,0.000172086367513,0.000139955157767,0.793241801121,0.0113115273428,0.760219319305,0.0190483427248,68.4452670026);
CALL InsertSrc(oimgid,266.062764823,-30.0017648549,0.000178353044021,0.000145202771655,0.802420411311,0.0117745781489,0.779040263212,0.0200000479299,66.9729415487);
CALL InsertSrc(oimgid,266.062914835,-29.8954351426,0.00017266660501,0.00015017532143,0.80498562429,0.0117940132699,0.790094330948,0.0201770031546,67.6327658852);
CALL InsertSrc(oimgid,266.063081467,-29.7886630914,0.000138513739046,0.000119573080205,0.837610294924,0.00975010140527,0.839366610185,0.016913450131,85.9204896135);
CALL InsertSrc(oimgid,266.063546461,-29.6818392415,0.000156517853668,0.000130705603368,0.858626376126,0.0112547096783,0.837752795403,0.0191789192719,74.8119993073);
CALL InsertSrc(oimgid,266.063984456,-29.5753130681,0.000143243276227,0.000120982606269,0.867319933626,0.0102441839497,0.875043496601,0.0178500329365,84.4380753428);
CALL InsertSrc(oimgid,265.938054813,-30.3215215381,0.000147394641658,0.000122854295586,0.899430590376,0.0108712435096,0.9020457921,0.0188670000152,82.079095559);
CALL InsertSrc(oimgid,265.938482863,-30.2150757715,0.000167132547233,0.000136292983118,0.905405531815,0.0120462873751,0.941139750072,0.0214138882078,76.3572484589);
CALL InsertSrc(oimgid,265.938966131,-30.1081175987,0.000143908862128,0.00012102632904,0.92434754856,0.0109847227561,0.931032142429,0.019119792618,83.9734532352);
CALL InsertSrc(oimgid,265.939546775,-30.0016592938,0.000166410138718,0.000139581343451,0.916941116886,0.0124525209581,0.939786481947,0.0219272764153,74.0496894553);
CALL InsertSrc(oimgid,265.940087427,-29.8949326646,0.000161241579349,0.000132162350155,0.944672485015,0.0125321224613,0.930127951064,0.0214845481964,74.7582062545);
CALL InsertSrc(oimgid,265.940454736,-29.7882380718,0.000134084106207,0.000111520047483,0.956830787149,0.0103930466535,0.98831762187,0.0183958474437,92.7929325881);
CALL InsertSrc(oimgid,265.940693244,-29.681436959,0.000136292590923,0.000116613206522,0.96913204883,0.0111747973597,0.952195897079,0.0191328777157,85.8105803724);
CALL InsertSrc(oimgid,265.941223982,-29.5749175949,0.000128848425049,0.000109137718635,1.00426030738,0.0109057620084,0.984995789611,0.018650225253,90.5520069903);
INSERT INTO assocxtrsources 
  (xtrsrc_id 
  ,assoc_xtrsrc_id 
  ,assoc_weight 
  ,assoc_distance_arcsec 
  ,assoc_lr_method 
  ,assoc_r 
  ,assoc_lr 
  ) 
  SELECT ut.xtrsrc_id 
        ,ut.assoc_xtrsrc_id 
        ,ut.assoc_weight 
        ,ut.assoc_distance_arcsec 
        ,ut.assoc_lr_method 
        ,ut.assoc_r 
        ,ut.assoc_lr 
    FROM (SELECT t2.xtrsrc_id 
                ,t2.assoc_xtrsrc_id  
                ,1 AS assoc_weight  
                ,t2.assoc_distance_arcsec  
                ,5 AS assoc_lr_method  
                ,t2.assoc_distance_arcsec / SQRT(t2.sigma_ra_squared + t2.sigma_decl_squared) AS assoc_r  
                ,LOG10(EXP(-t2.assoc_distance_arcsec * t2.assoc_distance_arcsec / (2 * (t2.sigma_ra_squared + t2.sigma_decl_squared)) ) / (2 * PI() * SQRT(t2.sigma_ra_squared) * SQRT(t2.sigma_decl_squared) * 4.02439375E-06) ) AS assoc_lr 
            FROM (SELECT t1.xtrsrc_id  
                        ,t1.assoc_xtrsrc_id  
                        ,3600 * DEGREES(2 * ASIN(SQRT( (t1.assoc_x - t1.x) * (t1.assoc_x - t1.x) + (t1.assoc_y - t1.y) * (t1.assoc_y - t1.y) + (t1.assoc_z - t1.z) * (t1.assoc_z - t1.z) ) / 2 ) ) AS assoc_distance_arcsec 
                        ,t1.assoc_ra_err * t1.assoc_ra_err + t1.ra_err * t1.ra_err AS sigma_ra_squared  
                        ,t1.assoc_decl_err * t1.assoc_decl_err + t1.decl_err * t1.decl_err AS sigma_decl_squared  
                    FROM (SELECT a1.xtrsrc_id AS xtrsrc_id  
                                ,x0.xtrsrcid AS assoc_xtrsrc_id 
                                ,x1.ra_err AS ra_err  
                                ,x1.decl_err AS decl_err  
                                ,x1.x AS x  
                                ,x1.y AS y  
                                ,x1.z AS z  
                                ,x0.ra_err AS assoc_ra_err  
                                ,x0.decl_err AS assoc_decl_err  
                                ,x0.x AS assoc_x  
                                ,x0.y AS assoc_y  
                                ,x0.z AS assoc_z  
                            FROM extractedsources x0  
                                ,images im0  
                                ,assocxtrsources a1  
                                ,extractedsources x1  
                                ,images im1 
                           WHERE x0.image_id = oimgid 
                             AND x0.image_id = im0.imageid  
                             AND a1.xtrsrc_id = x1.xtrsrcid  
                             AND a1.xtrsrc_id = a1.assoc_xtrsrc_id  
                             AND x1.image_id = im1.imageid  
                             AND im1.ds_id = im0.ds_id  
                             AND x1.zone BETWEEN CAST(FLOOR((x0.decl - 0.025) / 1) AS INTEGER)  
                                             AND CAST(FLOOR((x0.decl + 0.025) / 1) AS INTEGER)  
                             AND x1.ra BETWEEN x0.ra - alpha(0.025,x0.decl)  
                                           AND x0.ra + alpha(0.025,x0.decl)  
                             AND x1.decl BETWEEN x0.decl - 0.025  
                                             AND x0.decl + 0.025  
                             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z > COS(RADIANS(0.025))  
                         ) t1  
                 ) t2  
          UNION 
          SELECT a1.assoc_xtrsrc_id AS xtrsrc_id 
                ,a1.assoc_xtrsrc_id AS assoc_xtrsrc_id 
                ,2 AS assoc_weight 
                ,0 AS assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,0 AS assoc_r 
                ,LOG10(1 / (4 * pi() * x2.ra_err * x2.decl_err * 4.02439375E-06)) AS assoc_lr 
            FROM assocxtrsources a1 
                ,extractedsources x0 
                ,images im0 
                ,extractedsources x1 
                ,extractedsources x2 
                ,images im2 
           WHERE x0.image_id = oimgid 
             AND x0.image_id = im0.imageid  
             AND a1.assoc_xtrsrc_id = x2.xtrsrcid  
             AND x2.image_id = im2.imageid  
             AND im2.ds_id = im0.ds_id 
             AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025))  
             AND a1.xtrsrc_id = x1.xtrsrcid  
             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z < COS(RADIANS(0.025))  
             AND NOT EXISTS (SELECT t1.xtrsrc_id  
                               FROM assocxtrsources t1 
                              WHERE t1.xtrsrc_id = a1.assoc_xtrsrc_id 
                                AND t1.assoc_xtrsrc_id = t1.xtrsrc_id 
                            ) 
          UNION 
          SELECT t2.xtrsrc_id 
                ,t2.assoc_xtrsrc_id 
                ,3 AS assoc_weight 
                ,t2.assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,t2.assoc_distance_arcsec / SQRT(t2.sigma_ra_squared + t2.sigma_decl_squared) AS assoc_r 
                ,LOG10(EXP(-t2.assoc_distance_arcsec * t2.assoc_distance_arcsec 
                          / (2 * (t2.sigma_ra_squared + t2.sigma_decl_squared)) 
                          ) 
                      / (2 * PI() * SQRT(t2.sigma_ra_squared) * SQRT(t2.sigma_decl_squared) * 4.02439375E-06) 
                      ) AS assoc_lr 
            FROM (SELECT t1.xtrsrc_id 
                        ,t1.assoc_xtrsrc_id 
                        ,3600 * DEGREES(2 * ASIN(SQRT( (t1.assoc_x - t1.x) * (t1.assoc_x - t1.x) + (t1.assoc_y - t1.y) * (t1.assoc_y - t1.y) + (t1.assoc_z - t1.z) * (t1.assoc_z - t1.z) ) / 2 ) ) AS assoc_distance_arcsec 
                        ,t1.assoc_ra_err * t1.assoc_ra_err + t1.ra_err * t1.ra_err AS sigma_ra_squared 
                        ,t1.assoc_decl_err * t1.assoc_decl_err + t1.decl_err * t1.decl_err AS sigma_decl_squared 
                    FROM (SELECT a1.assoc_xtrsrc_id AS xtrsrc_id 
                                ,x2.ra_err AS ra_err 
                                ,x2.decl_err AS decl_err 
                                ,x2.x AS x 
                                ,x2.y AS y 
                                ,x2.z AS z 
                                ,x0.xtrsrcid AS assoc_xtrsrc_id 
                                ,x0.ra_err AS assoc_ra_err 
                                ,x0.decl_err AS assoc_decl_err 
                                ,x0.x AS assoc_x 
                                ,x0.y AS assoc_y 
                                ,x0.z AS assoc_z 
                            FROM assocxtrsources a1 
                                ,extractedsources x0 
                                ,images im0 
                                ,extractedsources x1 
                                ,extractedsources x2 
                                ,images im2 
                           WHERE x0.image_id = oimgid 
                             AND x0.image_id = im0.imageid  
                             AND a1.assoc_xtrsrc_id = x2.xtrsrcid  
                             AND x2.image_id = im2.imageid  
                             AND im2.ds_id = im0.ds_id 
                             AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025))  
                             AND a1.xtrsrc_id = x1.xtrsrcid  
                             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z < COS(RADIANS(0.025))  
                             AND NOT EXISTS (SELECT t1.xtrsrc_id  
                                               FROM assocxtrsources t1 
                                              WHERE t1.xtrsrc_id = a1.assoc_xtrsrc_id 
                                                AND t1.assoc_xtrsrc_id = t1.xtrsrc_id 
                                            ) 
                         ) t1 
                 ) t2 
          UNION 
          SELECT x10.xtrsrcid AS xtrsrc_id 
                ,x10.xtrsrcid AS assoc_xtrsrc_id 
                ,4 AS assoc_weight 
                ,0 AS assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,0 AS assoc_r 
                ,LOG10(1 / (4 * pi() * x10.ra_err * x10.decl_err * 4.02439375E-06)) AS assoc_lr 
            from extractedsources x10 
           where x10.image_id = oimgid 
             AND x10.xtrsrcid NOT IN (SELECT x0.xtrsrcid 
                                        FROM extractedsources x0 
                                            ,images im0 
                                            ,assocxtrsources a1 
                                            ,extractedsources x1 
                                            ,images im1 
                                       WHERE x0.image_id = oimgid 
                                         AND x0.image_id = im0.imageid 
                                         AND a1.xtrsrc_id = x1.xtrsrcid 
                                         AND x1.image_id = im1.imageid 
                                         AND im1.ds_id = im0.ds_id 
                                         AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z > COS(RADIANS(0.025)) 
                                     ) 
             AND x10.xtrsrcid NOT IN (SELECT x0.xtrsrcid 
                                        FROM extractedsources x0 
                                            ,images im0 
                                            ,assocxtrsources a1 
                                            ,extractedsources x2 
                                            ,images im2 
                                       WHERE x0.image_id = oimgid 
                                         AND x0.image_id = im0.imageid 
                                         AND a1.assoc_xtrsrc_id = x2.xtrsrcid 
                                         AND x2.image_id = im2.imageid 
                                         AND im2.ds_id = im0.ds_id 
                                         AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025)) 
                                     ) 
              ) ut 
;
SET oimgid = insertImage(odsid,324384765.625,3906250.0,'2002-09-30-10:00:00.0','/home/scheers/simsa/posflux/mJy_4maps1000/SOURCESINSERTED10.FITS');
CALL InsertSrc(oimgid,266.802410932,-29.7897710338,0.00176337230118,0.00133443802244,0.0907379146103,0.0113553134002,0.101784301301,0.0214455964577,8.058362569);
CALL InsertSrc(oimgid,266.801057301,-29.6823083311,0.0012892577509,0.00109913803443,0.0949332812343,0.00994474620802,0.0992153911844,0.017809321602,9.67455463513);
CALL InsertSrc(oimgid,266.799300353,-29.5735994762,0.00113224129382,0.00107497329836,0.100219271077,0.00994521353867,0.102609692844,0.0175561265309,9.75411886444);
CALL InsertSrc(oimgid,266.679251906,-30.0029368216,0.000713361772057,0.00062280314572,0.17534622983,0.0101817873878,0.186390859714,0.0183937785136,17.204463117);
CALL InsertSrc(oimgid,266.677743029,-29.6815422704,0.00051726145125,0.000414690760994,0.219432390815,0.00917342392995,0.219691607333,0.01591091981,23.9745205183);
CALL InsertSrc(oimgid,266.67801441,-29.5758585762,0.000557789871436,0.000488058936192,0.238616362199,0.0107160854006,0.250627465032,0.0192201415081,22.5341017389);
CALL InsertSrc(oimgid,266.678732481,-30.3219300153,0.00118920318249,0.000815421252213,0.135252299569,0.0113258697506,0.150027778473,0.0211014800835,12.4124028949);
CALL InsertSrc(oimgid,266.678875011,-30.2153681043,0.00108662771981,0.000955991870182,0.13513057766,0.0115769022306,0.15516146897,0.0220605557234,12.0186351696);
CALL InsertSrc(oimgid,266.67806342,-30.1084285894,0.000822165084344,0.000688562236135,0.16331507336,0.0106613961808,0.172035045491,0.0191575359385,15.4026847949);
CALL InsertSrc(oimgid,266.678383882,-29.895690365,0.000593891393748,0.000467951100408,0.203255184232,0.0101874846995,0.18479954212,0.0165839406193,19.1425078499);
CALL InsertSrc(oimgid,266.6777682,-29.7883045761,0.000651048433895,0.000531242730922,0.192170278012,0.010198116662,0.180130282931,0.0169816476871,18.5671478026);
CALL InsertSrc(oimgid,266.554888919,-29.8951871105,0.000390330956805,0.000339430775437,0.323231088073,0.0100248459692,0.363625524077,0.0188020536943,33.7657302539);
CALL InsertSrc(oimgid,266.556320951,-30.3227649034,0.000544356564603,0.000454966699209,0.251885806062,0.010906162592,0.271914641052,0.0198983438227,23.6448895659);
CALL InsertSrc(oimgid,266.555480175,-30.0026519389,0.00052913843075,0.000399283045848,0.282633729176,0.0114874115648,0.292893709656,0.0203912953765,25.2169547764);
CALL InsertSrc(oimgid,266.554750833,-29.7885485286,0.00033487607908,0.000282465819254,0.343784200249,0.00967443189556,0.33488161664,0.0164711455797,35.0164653996);
CALL InsertSrc(oimgid,266.554734058,-29.6821113699,0.000413122869304,0.000331718736522,0.347985044035,0.0117310024311,0.344502439351,0.0201910475407,29.5183855814);
CALL InsertSrc(oimgid,266.554655576,-29.5755356118,0.000295366706553,0.000274066119854,0.382623371276,0.00938197317404,0.40968046699,0.0170246969149,41.4123822881);
CALL InsertSrc(oimgid,266.555460727,-30.2153123185,0.00050621933633,0.00041519786048,0.26892834521,0.0113721608721,0.253299842254,0.0189461048024,22.6793457242);
CALL InsertSrc(oimgid,266.555200915,-30.1093774981,0.000476917403944,0.000406329099096,0.276327704512,0.0108760186527,0.274084790259,0.0187547874749,25.5113996792);
CALL InsertSrc(oimgid,266.432500596,-30.3222235321,0.000400182821124,0.000348083102036,0.36003327557,0.0119091431714,0.368386916716,0.0209547809472,30.5784104627);
CALL InsertSrc(oimgid,266.431973912,-30.2156801285,0.000335213538449,0.000279663095082,0.402019354563,0.0108879763791,0.422031259528,0.0194927572297,37.3471119918);
CALL InsertSrc(oimgid,266.432250107,-30.1093249079,0.000299240722939,0.000245353530822,0.412872687843,0.0101368620394,0.408458838449,0.0174358734007,40.1995315676);
CALL InsertSrc(oimgid,266.432368546,-30.002340916,0.000251497517979,0.000203473140733,0.424550914263,0.00887956826841,0.400904983023,0.0148096380958,46.9717647527);
CALL InsertSrc(oimgid,266.431766933,-29.8954062242,0.000321960059466,0.000270579484688,0.427110423702,0.0112989060841,0.430131823485,0.0196679503657,37.5844839424);
CALL InsertSrc(oimgid,266.432035558,-29.7889034034,0.000277630196138,0.000236027856591,0.463257850598,0.0109112557891,0.446142552541,0.0184354331661,41.7742256658);
CALL InsertSrc(oimgid,266.432050235,-29.6823286738,0.000300876518622,0.000260820120054,0.480366975069,0.0121298975102,0.483952992994,0.0211190476462,39.5722754074);
CALL InsertSrc(oimgid,266.431931378,-29.5757176999,0.000268108301725,0.000226912932245,0.474736815785,0.010889122824,0.451771338803,0.018255224742,42.5956764461);
CALL InsertSrc(oimgid,266.309370715,-29.7888483485,0.000247857008105,0.000207632978512,0.578494211686,0.0114086309326,0.626104871893,0.0208404364532,51.8752461661);
CALL InsertSrc(oimgid,266.309176255,-30.2157155822,0.000185186845272,0.00015114186354,0.519242658792,0.00779553542203,0.523499957015,0.0135770309443,66.4789944501);
CALL InsertSrc(oimgid,266.309245856,-30.0021887362,0.000232459540712,0.000193701030891,0.552761373421,0.010518127123,0.561163654437,0.0184049273031,52.8235799776);
CALL InsertSrc(oimgid,266.309301181,-29.6821700492,0.000202464391407,0.000172466050707,0.592127841322,0.0100521244707,0.5901635152,0.0173766288436,58.6299272398);
CALL InsertSrc(oimgid,266.309367667,-29.5755517439,0.000186414385325,0.000154184024709,0.621238192082,0.00959701990512,0.610976703835,0.0164405572602,63.9288730812);
CALL InsertSrc(oimgid,266.308597084,-30.3223143493,0.000253944463623,0.000213851708079,0.495726870666,0.01025961891,0.513949814281,0.0182098170821,48.8406122475);
CALL InsertSrc(oimgid,266.309010499,-30.1090507527,0.000226612203107,0.000192535966324,0.5460745708,0.010315852221,0.534526295441,0.017620665889,52.2466193765);
CALL InsertSrc(oimgid,266.308938123,-29.8958386756,0.000259122170348,0.000219004829059,0.551708053643,0.0116908310537,0.56776389387,0.0206440687513,47.3610341354);
CALL InsertSrc(oimgid,266.185209958,-30.322116588,0.000243008531129,0.000204572219786,0.613915507065,0.0121621976217,0.635595337647,0.0215658847995,51.0745303859);
CALL InsertSrc(oimgid,266.185249034,-30.2154488876,0.000167031057856,0.000142693522061,0.664488771839,0.00900720286503,0.700560319194,0.0161641514715,74.4325610696);
CALL InsertSrc(oimgid,266.185347424,-30.1086413746,0.000202693911547,0.000166846509522,0.649169082252,0.0106625120088,0.65899299823,0.018656027624,60.7685453493);
CALL InsertSrc(oimgid,266.185725831,-30.0021939421,0.000199433556645,0.00017097805539,0.661569971498,0.0109058700782,0.676953059273,0.0191838554117,61.1511457571);
CALL InsertSrc(oimgid,266.186242138,-29.8952943927,0.000174962673839,0.000149211610672,0.694469027433,0.0101224413408,0.686669672739,0.0174045326559,67.8816748863);
CALL InsertSrc(oimgid,266.186180013,-29.7887594481,0.000187837764599,0.000159440335949,0.713739427422,0.0111269832516,0.716357029295,0.0193211676283,63.8996395079);
CALL InsertSrc(oimgid,266.186340278,-29.6821034831,0.000182084351366,0.000153241814825,0.733050820514,0.0110593075254,0.730448912461,0.0191116444211,66.5644118299);
CALL InsertSrc(oimgid,266.186783134,-29.5756084402,0.000170436209316,0.000144587610013,0.764260899379,0.010859688581,0.766203938912,0.0188439860734,70.5624724484);
CALL InsertSrc(oimgid,266.06144638,-30.3220949845,0.000188947387642,0.000156154111743,0.77413385375,0.0118268846575,0.795237278043,0.0208579962342,65.899981792);
CALL InsertSrc(oimgid,266.06206354,-30.215210484,0.000207709312406,0.000170210099178,0.762486752198,0.0128307111965,0.774848165345,0.0224656052543,59.5438831522);
CALL InsertSrc(oimgid,266.062247252,-30.1085819786,0.000140491696243,0.000118921189145,0.790639338822,0.00931614353583,0.78106150357,0.0160109686072,83.9399303129);
CALL InsertSrc(oimgid,266.062576964,-30.0019082996,0.000163808030607,0.000138359785517,0.810044022636,0.0109164248769,0.817253438377,0.0190216453747,74.4231828428);
CALL InsertSrc(oimgid,266.062900503,-29.8953359694,0.0001410822303,0.00011827389589,0.844050891757,0.00973474954453,0.856883593045,0.0170330859197,87.237337122);
CALL InsertSrc(oimgid,266.063644636,-29.6819201752,0.000137183930519,0.000116161032096,0.868229588453,0.010001675382,0.84826538099,0.0170581948587,85.8006656388);
CALL InsertSrc(oimgid,266.063748543,-29.5752218284,0.000131641326732,0.000108987226081,0.881610491898,0.00950912248906,0.889438877543,0.0165684050599,92.7394946935);
CALL InsertSrc(oimgid,266.063043071,-29.7885683562,0.000143505413632,0.000123904374643,0.838316955395,0.0101479089455,0.825578166441,0.0173994809625,82.0434386554);
CALL InsertSrc(oimgid,265.938145908,-30.3216360111,0.00015453155703,0.000132076390745,0.882045418433,0.0112747006214,0.894044896864,0.0197064404647,78.1875826312);
CALL InsertSrc(oimgid,265.938461689,-30.2149874393,0.000143606666541,0.000119629637474,0.897440612238,0.0106813153702,0.881896286423,0.0182875455357,82.8721970108);
CALL InsertSrc(oimgid,265.939099439,-30.1083534357,0.00013516373167,0.000111806048125,0.915300695403,0.0101858856691,0.902050903,0.0174734070038,88.3140111405);
CALL InsertSrc(oimgid,265.939345986,-30.0015960663,0.000138839334454,0.000116988239228,0.949022633449,0.0108484859522,0.957996830062,0.0189093217344,87.1389294093);
CALL InsertSrc(oimgid,265.939781235,-29.8951093597,0.000123805368219,0.000104149579972,0.948615937871,0.00972359510269,0.949836070084,0.0168569853291,97.4285915013);
CALL InsertSrc(oimgid,265.940575737,-29.7882702326,0.00011735341792,9.75772567102e-05,0.971200887529,0.00941384425739,0.96334145968,0.0162177727809,102.551435053);
CALL InsertSrc(oimgid,265.940765584,-29.6815774067,0.000133629173149,0.000112495480369,1.00081645871,0.0110529227808,1.00447163617,0.0191916418714,90.3463119589);
CALL InsertSrc(oimgid,265.941423381,-29.5748614331,0.000120056423782,0.000102544566246,1.00964219725,0.0102155880288,0.990784868068,0.0174738606486,97.4306174091);
INSERT INTO assocxtrsources 
  (xtrsrc_id 
  ,assoc_xtrsrc_id 
  ,assoc_weight 
  ,assoc_distance_arcsec 
  ,assoc_lr_method 
  ,assoc_r 
  ,assoc_lr 
  ) 
  SELECT ut.xtrsrc_id 
        ,ut.assoc_xtrsrc_id 
        ,ut.assoc_weight 
        ,ut.assoc_distance_arcsec 
        ,ut.assoc_lr_method 
        ,ut.assoc_r 
        ,ut.assoc_lr 
    FROM (SELECT t2.xtrsrc_id 
                ,t2.assoc_xtrsrc_id  
                ,1 AS assoc_weight  
                ,t2.assoc_distance_arcsec  
                ,5 AS assoc_lr_method  
                ,t2.assoc_distance_arcsec / SQRT(t2.sigma_ra_squared + t2.sigma_decl_squared) AS assoc_r  
                ,LOG10(EXP(-t2.assoc_distance_arcsec * t2.assoc_distance_arcsec / (2 * (t2.sigma_ra_squared + t2.sigma_decl_squared)) ) / (2 * PI() * SQRT(t2.sigma_ra_squared) * SQRT(t2.sigma_decl_squared) * 4.02439375E-06) ) AS assoc_lr 
            FROM (SELECT t1.xtrsrc_id  
                        ,t1.assoc_xtrsrc_id  
                        ,3600 * DEGREES(2 * ASIN(SQRT( (t1.assoc_x - t1.x) * (t1.assoc_x - t1.x) + (t1.assoc_y - t1.y) * (t1.assoc_y - t1.y) + (t1.assoc_z - t1.z) * (t1.assoc_z - t1.z) ) / 2 ) ) AS assoc_distance_arcsec 
                        ,t1.assoc_ra_err * t1.assoc_ra_err + t1.ra_err * t1.ra_err AS sigma_ra_squared  
                        ,t1.assoc_decl_err * t1.assoc_decl_err + t1.decl_err * t1.decl_err AS sigma_decl_squared  
                    FROM (SELECT a1.xtrsrc_id AS xtrsrc_id  
                                ,x0.xtrsrcid AS assoc_xtrsrc_id 
                                ,x1.ra_err AS ra_err  
                                ,x1.decl_err AS decl_err  
                                ,x1.x AS x  
                                ,x1.y AS y  
                                ,x1.z AS z  
                                ,x0.ra_err AS assoc_ra_err  
                                ,x0.decl_err AS assoc_decl_err  
                                ,x0.x AS assoc_x  
                                ,x0.y AS assoc_y  
                                ,x0.z AS assoc_z  
                            FROM extractedsources x0  
                                ,images im0  
                                ,assocxtrsources a1  
                                ,extractedsources x1  
                                ,images im1 
                           WHERE x0.image_id = oimgid 
                             AND x0.image_id = im0.imageid  
                             AND a1.xtrsrc_id = x1.xtrsrcid  
                             AND a1.xtrsrc_id = a1.assoc_xtrsrc_id  
                             AND x1.image_id = im1.imageid  
                             AND im1.ds_id = im0.ds_id  
                             AND x1.zone BETWEEN CAST(FLOOR((x0.decl - 0.025) / 1) AS INTEGER)  
                                             AND CAST(FLOOR((x0.decl + 0.025) / 1) AS INTEGER)  
                             AND x1.ra BETWEEN x0.ra - alpha(0.025,x0.decl)  
                                           AND x0.ra + alpha(0.025,x0.decl)  
                             AND x1.decl BETWEEN x0.decl - 0.025  
                                             AND x0.decl + 0.025  
                             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z > COS(RADIANS(0.025))  
                         ) t1  
                 ) t2  
          UNION 
          SELECT a1.assoc_xtrsrc_id AS xtrsrc_id 
                ,a1.assoc_xtrsrc_id AS assoc_xtrsrc_id 
                ,2 AS assoc_weight 
                ,0 AS assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,0 AS assoc_r 
                ,LOG10(1 / (4 * pi() * x2.ra_err * x2.decl_err * 4.02439375E-06)) AS assoc_lr 
            FROM assocxtrsources a1 
                ,extractedsources x0 
                ,images im0 
                ,extractedsources x1 
                ,extractedsources x2 
                ,images im2 
           WHERE x0.image_id = oimgid 
             AND x0.image_id = im0.imageid  
             AND a1.assoc_xtrsrc_id = x2.xtrsrcid  
             AND x2.image_id = im2.imageid  
             AND im2.ds_id = im0.ds_id 
             AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025))  
             AND a1.xtrsrc_id = x1.xtrsrcid  
             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z < COS(RADIANS(0.025))  
             AND NOT EXISTS (SELECT t1.xtrsrc_id  
                               FROM assocxtrsources t1 
                              WHERE t1.xtrsrc_id = a1.assoc_xtrsrc_id 
                                AND t1.assoc_xtrsrc_id = t1.xtrsrc_id 
                            ) 
          UNION 
          SELECT t2.xtrsrc_id 
                ,t2.assoc_xtrsrc_id 
                ,3 AS assoc_weight 
                ,t2.assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,t2.assoc_distance_arcsec / SQRT(t2.sigma_ra_squared + t2.sigma_decl_squared) AS assoc_r 
                ,LOG10(EXP(-t2.assoc_distance_arcsec * t2.assoc_distance_arcsec 
                          / (2 * (t2.sigma_ra_squared + t2.sigma_decl_squared)) 
                          ) 
                      / (2 * PI() * SQRT(t2.sigma_ra_squared) * SQRT(t2.sigma_decl_squared) * 4.02439375E-06) 
                      ) AS assoc_lr 
            FROM (SELECT t1.xtrsrc_id 
                        ,t1.assoc_xtrsrc_id 
                        ,3600 * DEGREES(2 * ASIN(SQRT( (t1.assoc_x - t1.x) * (t1.assoc_x - t1.x) + (t1.assoc_y - t1.y) * (t1.assoc_y - t1.y) + (t1.assoc_z - t1.z) * (t1.assoc_z - t1.z) ) / 2 ) ) AS assoc_distance_arcsec 
                        ,t1.assoc_ra_err * t1.assoc_ra_err + t1.ra_err * t1.ra_err AS sigma_ra_squared 
                        ,t1.assoc_decl_err * t1.assoc_decl_err + t1.decl_err * t1.decl_err AS sigma_decl_squared 
                    FROM (SELECT a1.assoc_xtrsrc_id AS xtrsrc_id 
                                ,x2.ra_err AS ra_err 
                                ,x2.decl_err AS decl_err 
                                ,x2.x AS x 
                                ,x2.y AS y 
                                ,x2.z AS z 
                                ,x0.xtrsrcid AS assoc_xtrsrc_id 
                                ,x0.ra_err AS assoc_ra_err 
                                ,x0.decl_err AS assoc_decl_err 
                                ,x0.x AS assoc_x 
                                ,x0.y AS assoc_y 
                                ,x0.z AS assoc_z 
                            FROM assocxtrsources a1 
                                ,extractedsources x0 
                                ,images im0 
                                ,extractedsources x1 
                                ,extractedsources x2 
                                ,images im2 
                           WHERE x0.image_id = oimgid 
                             AND x0.image_id = im0.imageid  
                             AND a1.assoc_xtrsrc_id = x2.xtrsrcid  
                             AND x2.image_id = im2.imageid  
                             AND im2.ds_id = im0.ds_id 
                             AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025))  
                             AND a1.xtrsrc_id = x1.xtrsrcid  
                             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z < COS(RADIANS(0.025))  
                             AND NOT EXISTS (SELECT t1.xtrsrc_id  
                                               FROM assocxtrsources t1 
                                              WHERE t1.xtrsrc_id = a1.assoc_xtrsrc_id 
                                                AND t1.assoc_xtrsrc_id = t1.xtrsrc_id 
                                            ) 
                         ) t1 
                 ) t2 
          UNION 
          SELECT x10.xtrsrcid AS xtrsrc_id 
                ,x10.xtrsrcid AS assoc_xtrsrc_id 
                ,4 AS assoc_weight 
                ,0 AS assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,0 AS assoc_r 
                ,LOG10(1 / (4 * pi() * x10.ra_err * x10.decl_err * 4.02439375E-06)) AS assoc_lr 
            from extractedsources x10 
           where x10.image_id = oimgid 
             AND x10.xtrsrcid NOT IN (SELECT x0.xtrsrcid 
                                        FROM extractedsources x0 
                                            ,images im0 
                                            ,assocxtrsources a1 
                                            ,extractedsources x1 
                                            ,images im1 
                                       WHERE x0.image_id = oimgid 
                                         AND x0.image_id = im0.imageid 
                                         AND a1.xtrsrc_id = x1.xtrsrcid 
                                         AND x1.image_id = im1.imageid 
                                         AND im1.ds_id = im0.ds_id 
                                         AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z > COS(RADIANS(0.025)) 
                                     ) 
             AND x10.xtrsrcid NOT IN (SELECT x0.xtrsrcid 
                                        FROM extractedsources x0 
                                            ,images im0 
                                            ,assocxtrsources a1 
                                            ,extractedsources x2 
                                            ,images im2 
                                       WHERE x0.image_id = oimgid 
                                         AND x0.image_id = im0.imageid 
                                         AND a1.assoc_xtrsrc_id = x2.xtrsrcid 
                                         AND x2.image_id = im2.imageid 
                                         AND im2.ds_id = im0.ds_id 
                                         AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025)) 
                                     ) 
              ) ut 
;
SET oimgid = insertImage(odsid,324384765.625,3906250.0,'2002-10-04-04:00:00.0','/home/scheers/simsa/posflux/mJy_4maps1000/SOURCESINSERTED100.FITS');
CALL InsertSrc(oimgid,266.800163976,-29.6814955996,0.00120547542923,0.00083882898689,0.11676909375,0.0101904510636,0.125433418256,0.0185809709158,11.740936529);
CALL InsertSrc(oimgid,266.800864428,-29.7884651879,0.00143770271126,0.00129014670324,0.0775116437329,0.00926790437647,0.0779529335849,0.0162264879249,8.48048145021);
CALL InsertSrc(oimgid,266.799253942,-29.5739882037,0.00103557802936,0.000856124236414,0.113092610033,0.00987382936269,0.098803591567,0.0157539320532,10.6473735255);
CALL InsertSrc(oimgid,266.680139794,-30.1088928622,0.000880635536532,0.000691352278171,0.150376300119,0.010555486172,0.150154311952,0.0182982176183,14.0502707322);
CALL InsertSrc(oimgid,266.678000814,-29.8949500681,0.000612469081148,0.00052610239586,0.183155730261,0.00931614178662,0.18861195452,0.0164790875996,19.3029313739);
CALL InsertSrc(oimgid,266.677815876,-29.787928716,0.000616356482965,0.000496285226362,0.206305745075,0.0100183944878,0.218107791002,0.018024986013,20.6724938416);
CALL InsertSrc(oimgid,266.677667397,-29.6819776833,0.000619669992886,0.00050669294658,0.2254481263,0.0107779018259,0.254421924622,0.0202660032876,21.394071235);
CALL InsertSrc(oimgid,266.680283865,-30.3228287386,0.000831109347018,0.00072377666363,0.13207793214,0.00945173253763,0.127338496455,0.0160085683299,13.7914111085);
CALL InsertSrc(oimgid,266.678411639,-30.2148348171,0.000908794896588,0.000767470098374,0.142097438684,0.0100334381346,0.157384198532,0.0186536060006,14.2023158076);
CALL InsertSrc(oimgid,266.67792027,-30.0020963765,0.000884613471442,0.000666856676784,0.16734816697,0.0113759278815,0.163810145408,0.0195066595266,14.4829532186);
CALL InsertSrc(oimgid,266.676252311,-29.5745462607,0.000529691764427,0.000483796751599,0.248325522777,0.0104874097376,0.294558399303,0.0204016365398,24.8255060274);
CALL InsertSrc(oimgid,266.554257946,-29.6820965728,0.00038283773705,0.00032902893421,0.349935260653,0.0107544058737,0.383708659152,0.0198245359202,33.7339580365);
CALL InsertSrc(oimgid,266.555888016,-30.3226057597,0.000588044371455,0.000507539174496,0.241990754794,0.0112978276563,0.263081158442,0.0207192368701,22.0903484672);
CALL InsertSrc(oimgid,266.556073927,-30.2149435419,0.000413399546403,0.000357597922825,0.274439536328,0.00911719807557,0.283368319001,0.0161629812471,30.0838794307);
CALL InsertSrc(oimgid,266.555367626,-30.1088015869,0.000522060082403,0.000446609122058,0.278869561038,0.0120525773336,0.284731349936,0.0211820165328,23.0596086233);
CALL InsertSrc(oimgid,266.554895498,-30.0021423802,0.000530344168965,0.00043356896883,0.295905791726,0.0127404399148,0.300951947457,0.0223325166609,23.2256589924);
CALL InsertSrc(oimgid,266.55494423,-29.8952956873,0.000381325722856,0.000343321813912,0.330049757499,0.0105160662785,0.348567786186,0.0188995632836,32.0841828821);
CALL InsertSrc(oimgid,266.554729856,-29.7888660152,0.000431085977027,0.000353915694554,0.334907428531,0.0115246687608,0.34941576241,0.0205449674775,29.4918427671);
CALL InsertSrc(oimgid,266.5542737,-29.5755526323,0.000335472353356,0.000273720685755,0.364899831864,0.0103199624812,0.337601864583,0.0169860431889,34.3945525766);
CALL InsertSrc(oimgid,266.432814217,-30.3221155141,0.000348945860821,0.00029733557221,0.366431685257,0.0105909981725,0.37439396591,0.0186289121229,34.7178824718);
CALL InsertSrc(oimgid,266.431677924,-30.2156285169,0.000284917318027,0.000243284388564,0.407988569567,0.00949917003503,0.42825941528,0.0170045668453,43.6701377419);
CALL InsertSrc(oimgid,266.432020354,-30.1088208184,0.00035284945119,0.000307282078296,0.412140244349,0.0121168784635,0.421254471499,0.0213022760408,33.7702890009);
CALL InsertSrc(oimgid,266.432276889,-30.0022763431,0.000327224496914,0.000277594847748,0.42374157166,0.0115282785988,0.428752778776,0.0201409994798,36.4974218049);
CALL InsertSrc(oimgid,266.432139854,-29.8957092541,0.000282031619804,0.000232922901485,0.454153267314,0.0104340322556,0.455210905878,0.018105830849,43.4843678505);
CALL InsertSrc(oimgid,266.432146282,-29.7889775439,0.000307293578999,0.000265447729184,0.469005269747,0.0120753196769,0.463319330278,0.0207546761963,38.5605213368);
CALL InsertSrc(oimgid,266.431986808,-29.6822717264,0.000263124215564,0.000223082552225,0.481010098244,0.0106016179502,0.477453363363,0.0182766492237,44.7768526353);
CALL InsertSrc(oimgid,266.431922125,-29.5759472591,0.000325954369771,0.000279075211846,0.47436308316,0.0127924628595,0.486953189221,0.0225547193908,37.2449332681);
CALL InsertSrc(oimgid,266.308969376,-30.2156987802,0.00024226018428,0.000207889295236,0.515129356024,0.0103918324426,0.51738301322,0.0180541199312,49.9816606694);
CALL InsertSrc(oimgid,266.30918331,-30.1092043823,0.000214198763274,0.000171736254284,0.534558170566,0.00939978705493,0.515429889096,0.0158933846018,56.4654458973);
CALL InsertSrc(oimgid,266.309058456,-29.895426795,0.000217050441847,0.000181189252661,0.576971129236,0.0103023544169,0.578439662669,0.0178764200031,55.6526484235);
CALL InsertSrc(oimgid,266.308980943,-29.7886425121,0.000240000741258,0.000194677555463,0.584464485918,0.0112734898623,0.59679693401,0.0198032043612,52.4772166993);
CALL InsertSrc(oimgid,266.308691249,-30.3220003899,0.000242743914555,0.000199933387158,0.52537015174,0.0106808374156,0.50036516486,0.0179129262079,47.5485039802);
CALL InsertSrc(oimgid,266.308728177,-30.002376286,0.000246255826369,0.000199719919607,0.557358539034,0.0111063772149,0.563004895586,0.0193692211381,50.1814017809);
CALL InsertSrc(oimgid,266.309165714,-29.6824439359,0.000197875409015,0.000163765477787,0.616147708531,0.0100352136966,0.612761060536,0.0173194426761,61.1582246199);
CALL InsertSrc(oimgid,266.309029352,-29.5753888864,0.00020426031034,0.000174288530896,0.608035743874,0.0102714245211,0.623476511364,0.0180944453491,59.5010684887);
CALL InsertSrc(oimgid,266.185278095,-30.2153778597,0.000201060701727,0.000166045333359,0.646698452468,0.0105649708053,0.657701899699,0.0185080527015,61.5238493876);
CALL InsertSrc(oimgid,266.185824553,-30.1089651218,0.000186556843744,0.000162642062005,0.674063691585,0.0104567180708,0.690796709289,0.0184121952094,64.5977648931);
CALL InsertSrc(oimgid,266.185769117,-30.0021696009,0.000171842221732,0.000146835359292,0.676026707839,0.00961980355708,0.686546781893,0.0168359730684,70.4800683132);
CALL InsertSrc(oimgid,266.186200721,-29.8955900497,0.000168812124855,0.000143035661736,0.69623200071,0.00960845357962,0.712835206685,0.0169084213256,72.9321374743);
CALL InsertSrc(oimgid,266.186529363,-29.7888592583,0.000192131171957,0.000164676731337,0.724351601449,0.011624872656,0.721239236017,0.0200794044289,62.3036674681);
CALL InsertSrc(oimgid,266.186428244,-29.6820119207,0.000173340274841,0.0001465203371,0.754578045059,0.0108662002809,0.748409943399,0.0187204518241,68.6748349524);
CALL InsertSrc(oimgid,266.18644496,-29.5754948165,0.00018558380458,0.000159685750472,0.756711487328,0.011697039526,0.7549138765,0.020233334633,64.1735251184);
CALL InsertSrc(oimgid,266.185127127,-30.3222759412,0.000182025331753,0.000154328234196,0.625038804557,0.00932920206603,0.641649568848,0.0164461904112,67.2862835523);
CALL InsertSrc(oimgid,266.06213692,-30.2152407185,0.000171468682538,0.000142544683246,0.771872084582,0.0108959689129,0.770400932933,0.01884989167,70.5459542968);
CALL InsertSrc(oimgid,266.062323291,-30.1086825538,0.000169612955574,0.000142082449862,0.792795060991,0.010930877635,0.818094244896,0.0193359340313,73.0873432893);
CALL InsertSrc(oimgid,266.062421469,-30.0019497983,0.000145672436361,0.000122975608239,0.818266270657,0.00992052477179,0.80852220725,0.0170472694873,81.7175277878);
CALL InsertSrc(oimgid,266.062868012,-29.8952305635,0.000151534778979,0.000125482411132,0.804713288399,0.00993279964148,0.819750841441,0.0174191456469,81.2176201936);
CALL InsertSrc(oimgid,266.06337603,-29.7886483931,0.000162364115397,0.000134883900039,0.867956809186,0.0114496766403,0.87669057967,0.0199697969463,75.7156031209);
CALL InsertSrc(oimgid,266.063763123,-29.6819290081,0.000162656467467,0.000141904108812,0.843400952161,0.0113044972289,0.875508200123,0.0200780797661,75.5311457504);
CALL InsertSrc(oimgid,266.06370744,-29.5752904121,0.000138221016186,0.000115896579054,0.889170144849,0.010070974667,0.901266586566,0.0176028629524,88.4601322418);
CALL InsertSrc(oimgid,266.061281059,-30.3219061118,0.000168736350076,0.000141608154919,0.774865100714,0.0107991162034,0.766400794069,0.0185706620971,71.2992380297);
CALL InsertSrc(oimgid,265.9379353,-30.321490059,0.000139477960374,0.000114510569155,0.905582505507,0.0104617242182,0.882091533533,0.0178074178706,85.3405785297);
CALL InsertSrc(oimgid,265.938589919,-30.2149086937,0.000183072218078,0.000150315218679,0.886870616362,0.0132364481126,0.888155313361,0.0229500967571,67.197741138);
CALL InsertSrc(oimgid,265.938888253,-30.1081923919,0.000154051361619,0.000128308180159,0.911698075943,0.0115789089403,0.907879696921,0.0200003319395,77.9573892489);
CALL InsertSrc(oimgid,265.939460222,-30.0015709687,0.000138266092677,0.000114840009793,0.953685171167,0.010741318274,0.965330727527,0.018757230079,88.4212191684);
CALL InsertSrc(oimgid,265.939922588,-29.89492373,0.000181493397974,0.000148970864295,0.946455449437,0.0139628140946,0.948362735866,0.0242209519497,67.2856474529);
CALL InsertSrc(oimgid,265.940367834,-29.7883455644,0.000112649007974,9.44837254657e-05,0.962463620625,0.00880928146949,0.992555139862,0.0155759913983,110.355843322);
CALL InsertSrc(oimgid,265.940663186,-29.6815615625,0.000128951037198,0.000107552554098,0.977274169192,0.0102739692882,1.00269017654,0.0181037119041,95.7121103303);
CALL InsertSrc(oimgid,265.941137275,-29.5749620074,0.000143400202205,0.000121813587825,1.00746615162,0.0119602014403,1.00951620439,0.0207466554742,83.8123813503);
INSERT INTO assocxtrsources 
  (xtrsrc_id 
  ,assoc_xtrsrc_id 
  ,assoc_weight 
  ,assoc_distance_arcsec 
  ,assoc_lr_method 
  ,assoc_r 
  ,assoc_lr 
  ) 
  SELECT ut.xtrsrc_id 
        ,ut.assoc_xtrsrc_id 
        ,ut.assoc_weight 
        ,ut.assoc_distance_arcsec 
        ,ut.assoc_lr_method 
        ,ut.assoc_r 
        ,ut.assoc_lr 
    FROM (SELECT t2.xtrsrc_id 
                ,t2.assoc_xtrsrc_id  
                ,1 AS assoc_weight  
                ,t2.assoc_distance_arcsec  
                ,5 AS assoc_lr_method  
                ,t2.assoc_distance_arcsec / SQRT(t2.sigma_ra_squared + t2.sigma_decl_squared) AS assoc_r  
                ,LOG10(EXP(-t2.assoc_distance_arcsec * t2.assoc_distance_arcsec / (2 * (t2.sigma_ra_squared + t2.sigma_decl_squared)) ) / (2 * PI() * SQRT(t2.sigma_ra_squared) * SQRT(t2.sigma_decl_squared) * 4.02439375E-06) ) AS assoc_lr 
            FROM (SELECT t1.xtrsrc_id  
                        ,t1.assoc_xtrsrc_id  
                        ,3600 * DEGREES(2 * ASIN(SQRT( (t1.assoc_x - t1.x) * (t1.assoc_x - t1.x) + (t1.assoc_y - t1.y) * (t1.assoc_y - t1.y) + (t1.assoc_z - t1.z) * (t1.assoc_z - t1.z) ) / 2 ) ) AS assoc_distance_arcsec 
                        ,t1.assoc_ra_err * t1.assoc_ra_err + t1.ra_err * t1.ra_err AS sigma_ra_squared  
                        ,t1.assoc_decl_err * t1.assoc_decl_err + t1.decl_err * t1.decl_err AS sigma_decl_squared  
                    FROM (SELECT a1.xtrsrc_id AS xtrsrc_id  
                                ,x0.xtrsrcid AS assoc_xtrsrc_id 
                                ,x1.ra_err AS ra_err  
                                ,x1.decl_err AS decl_err  
                                ,x1.x AS x  
                                ,x1.y AS y  
                                ,x1.z AS z  
                                ,x0.ra_err AS assoc_ra_err  
                                ,x0.decl_err AS assoc_decl_err  
                                ,x0.x AS assoc_x  
                                ,x0.y AS assoc_y  
                                ,x0.z AS assoc_z  
                            FROM extractedsources x0  
                                ,images im0  
                                ,assocxtrsources a1  
                                ,extractedsources x1  
                                ,images im1 
                           WHERE x0.image_id = oimgid 
                             AND x0.image_id = im0.imageid  
                             AND a1.xtrsrc_id = x1.xtrsrcid  
                             AND a1.xtrsrc_id = a1.assoc_xtrsrc_id  
                             AND x1.image_id = im1.imageid  
                             AND im1.ds_id = im0.ds_id  
                             AND x1.zone BETWEEN CAST(FLOOR((x0.decl - 0.025) / 1) AS INTEGER)  
                                             AND CAST(FLOOR((x0.decl + 0.025) / 1) AS INTEGER)  
                             AND x1.ra BETWEEN x0.ra - alpha(0.025,x0.decl)  
                                           AND x0.ra + alpha(0.025,x0.decl)  
                             AND x1.decl BETWEEN x0.decl - 0.025  
                                             AND x0.decl + 0.025  
                             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z > COS(RADIANS(0.025))  
                         ) t1  
                 ) t2  
          UNION 
          SELECT a1.assoc_xtrsrc_id AS xtrsrc_id 
                ,a1.assoc_xtrsrc_id AS assoc_xtrsrc_id 
                ,2 AS assoc_weight 
                ,0 AS assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,0 AS assoc_r 
                ,LOG10(1 / (4 * pi() * x2.ra_err * x2.decl_err * 4.02439375E-06)) AS assoc_lr 
            FROM assocxtrsources a1 
                ,extractedsources x0 
                ,images im0 
                ,extractedsources x1 
                ,extractedsources x2 
                ,images im2 
           WHERE x0.image_id = oimgid 
             AND x0.image_id = im0.imageid  
             AND a1.assoc_xtrsrc_id = x2.xtrsrcid  
             AND x2.image_id = im2.imageid  
             AND im2.ds_id = im0.ds_id 
             AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025))  
             AND a1.xtrsrc_id = x1.xtrsrcid  
             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z < COS(RADIANS(0.025))  
             AND NOT EXISTS (SELECT t1.xtrsrc_id  
                               FROM assocxtrsources t1 
                              WHERE t1.xtrsrc_id = a1.assoc_xtrsrc_id 
                                AND t1.assoc_xtrsrc_id = t1.xtrsrc_id 
                            ) 
          UNION 
          SELECT t2.xtrsrc_id 
                ,t2.assoc_xtrsrc_id 
                ,3 AS assoc_weight 
                ,t2.assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,t2.assoc_distance_arcsec / SQRT(t2.sigma_ra_squared + t2.sigma_decl_squared) AS assoc_r 
                ,LOG10(EXP(-t2.assoc_distance_arcsec * t2.assoc_distance_arcsec 
                          / (2 * (t2.sigma_ra_squared + t2.sigma_decl_squared)) 
                          ) 
                      / (2 * PI() * SQRT(t2.sigma_ra_squared) * SQRT(t2.sigma_decl_squared) * 4.02439375E-06) 
                      ) AS assoc_lr 
            FROM (SELECT t1.xtrsrc_id 
                        ,t1.assoc_xtrsrc_id 
                        ,3600 * DEGREES(2 * ASIN(SQRT( (t1.assoc_x - t1.x) * (t1.assoc_x - t1.x) + (t1.assoc_y - t1.y) * (t1.assoc_y - t1.y) + (t1.assoc_z - t1.z) * (t1.assoc_z - t1.z) ) / 2 ) ) AS assoc_distance_arcsec 
                        ,t1.assoc_ra_err * t1.assoc_ra_err + t1.ra_err * t1.ra_err AS sigma_ra_squared 
                        ,t1.assoc_decl_err * t1.assoc_decl_err + t1.decl_err * t1.decl_err AS sigma_decl_squared 
                    FROM (SELECT a1.assoc_xtrsrc_id AS xtrsrc_id 
                                ,x2.ra_err AS ra_err 
                                ,x2.decl_err AS decl_err 
                                ,x2.x AS x 
                                ,x2.y AS y 
                                ,x2.z AS z 
                                ,x0.xtrsrcid AS assoc_xtrsrc_id 
                                ,x0.ra_err AS assoc_ra_err 
                                ,x0.decl_err AS assoc_decl_err 
                                ,x0.x AS assoc_x 
                                ,x0.y AS assoc_y 
                                ,x0.z AS assoc_z 
                            FROM assocxtrsources a1 
                                ,extractedsources x0 
                                ,images im0 
                                ,extractedsources x1 
                                ,extractedsources x2 
                                ,images im2 
                           WHERE x0.image_id = oimgid 
                             AND x0.image_id = im0.imageid  
                             AND a1.assoc_xtrsrc_id = x2.xtrsrcid  
                             AND x2.image_id = im2.imageid  
                             AND im2.ds_id = im0.ds_id 
                             AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025))  
                             AND a1.xtrsrc_id = x1.xtrsrcid  
                             AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z < COS(RADIANS(0.025))  
                             AND NOT EXISTS (SELECT t1.xtrsrc_id  
                                               FROM assocxtrsources t1 
                                              WHERE t1.xtrsrc_id = a1.assoc_xtrsrc_id 
                                                AND t1.assoc_xtrsrc_id = t1.xtrsrc_id 
                                            ) 
                         ) t1 
                 ) t2 
          UNION 
          SELECT x10.xtrsrcid AS xtrsrc_id 
                ,x10.xtrsrcid AS assoc_xtrsrc_id 
                ,4 AS assoc_weight 
                ,0 AS assoc_distance_arcsec 
                ,5 AS assoc_lr_method 
                ,0 AS assoc_r 
                ,LOG10(1 / (4 * pi() * x10.ra_err * x10.decl_err * 4.02439375E-06)) AS assoc_lr 
            from extractedsources x10 
           where x10.image_id = oimgid 
             AND x10.xtrsrcid NOT IN (SELECT x0.xtrsrcid 
                                        FROM extractedsources x0 
                                            ,images im0 
                                            ,assocxtrsources a1 
                                            ,extractedsources x1 
                                            ,images im1 
                                       WHERE x0.image_id = oimgid 
                                         AND x0.image_id = im0.imageid 
                                         AND a1.xtrsrc_id = x1.xtrsrcid 
                                         AND x1.image_id = im1.imageid 
                                         AND im1.ds_id = im0.ds_id 
                                         AND x0.x * x1.x + x0.y * x1.y + x0.z * x1.z > COS(RADIANS(0.025)) 
                                     ) 
             AND x10.xtrsrcid NOT IN (SELECT x0.xtrsrcid 
                                        FROM extractedsources x0 
                                            ,images im0 
                                            ,assocxtrsources a1 
                                            ,extractedsources x2 
                                            ,images im2 
                                       WHERE x0.image_id = oimgid 
                                         AND x0.image_id = im0.imageid 
                                         AND a1.assoc_xtrsrc_id = x2.xtrsrcid 
                                         AND x2.image_id = im2.imageid 
                                         AND im2.ds_id = im0.ds_id 
                                         AND x0.x * x2.x + x0.y * x2.y + x0.z * x2.z > COS(RADIANS(0.025)) 
                                     ) 
              ) ut 
;
